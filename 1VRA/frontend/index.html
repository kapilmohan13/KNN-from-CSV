<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volatility Risk Analyzer (VRA)</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar / Navigation -->
        <nav class="sidebar">
            <div class="logo">
                <h2>VRA System</h2>
            </div>
            <ul class="nav-links">
                <li class="active" data-tab="indicators">Indicators Calculator</li>
                <li data-tab="volatility">2. Volatility & Labels</li>
                <li data-tab="clustering">3. DBSCAN Clustering</li>
                <li class="disabled">Risk Analysis (Coming Soon)</li>
                <li class="disabled">Backtesting (Coming Soon)</li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Indicators Tab -->
            <div id="indicators" class="tab-content active">
                <header class="tab-header">
                    <h1>Indicators Calculator</h1>
                    <p>Process historical data to generate technical indicators.</p>
                </header>

                <div class="card upload-section">
                    <h3>1. Datasets</h3>
                    <div class="file-upload-container">
                        <label for="csvFile" class="file-drop-zone">
                            <span class="icon">ðŸ“‚</span>
                            <span class="text">Click to select CSV file</span>
                            <span class="subtext" id="fileName">No file selected</span>
                        </label>
                        <input type="file" id="csvFile" accept=".csv" hidden>
                        <button id="calculateBtn" class="btn primary" disabled>Calculate Indicators</button>
                    </div>
                </div>

                <div class="grid-container">
                    <div class="card log-section">
                        <h3>2. Server Status & Logs</h3>
                        <div id="serverLogs" class="log-window">
                            <div class="log-entry system">Waiting for action...</div>
                        </div>
                    </div>

                    <div class="card parameters-section">
                        <h3>Parameters Used</h3>
                        <ul class="params-list">
                            <li><strong>RSI:</strong> 14 periods</li>
                            <li><strong>Stoch RSI:</strong> 14 periods</li>
                            <li><strong>MACD:</strong> 12, 26, 9</li>
                            <li><strong>Moving Average:</strong> 16 periods</li>
                            <li><strong>ROC:</strong> 10 periods</li>
                            <li><strong>Williams %R:</strong> 14 periods</li>
                            <li><strong>VWMA:</strong> 14 periods</li>
                            <li><strong>Linear Reg MA:</strong> 14 periods</li>
                        </ul>
                    </div>
                </div>

                <div class="card preview-section hidden" id="previewCard">
                    <h3>3. Output Preview</h3>
                    <div class="output-info">
                        <strong>Saved to:</strong> <span id="outputPath" class="highlight-path">...</span>
                        <button class="btn small" onclick="copyPath('outputPath')">Copy Path</button>
                    </div>
                    <div class="table-wrapper">
                        <table id="previewTable">
                            <thead></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Volatility Tab -->
            <div id="volatility" class="tab-content hidden">
                <header class="tab-header">
                    <h1>Volatility Calculator</h1>
                    <p>Compute historical volatility (Log Returns Std Dev) for risk analysis.</p>
                </header>

                <div class="card">
                    <h3>1. Input Data & Volatility Calculation</h3>
                    <div class="file-upload-container">
                        <div class="input-group">
                            <label>File Path (Previous Output Preselected)</label>
                            <div class="row">
                                <input type="text" id="volInputPath" class="input-text"
                                    placeholder="Path to processed CSV...">
                                <label for="volCsvFile" class="btn small">Browse</label>
                                <input type="file" id="volCsvFile" accept=".csv" hidden>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Window Size (Periods)</label>
                            <input type="number" id="volWindow" class="input-number" value="21" min="2">
                        </div>
                        <button id="computeVolBtn" class="btn primary">Compute Volatility</button>
                    </div>
                </div>

                <div class="card">
                    <h3>2. Label Addition</h3>
                    <div class="label-section">
                        <div class="input-group">
                            <label>Labelling Strategy</label>
                            <select id="labelStrategy" class="input-select">
                                <option value="relative_thresholds">Relative Thresholds (Percentile Based)</option>
                                <option value="future_strategy" disabled>Future Strategy (Coming Soon)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Strategy Description</label>
                            <textarea id="labelDesc" class="desc-box" readonly>Compare each rowâ€™s volatility to the historical distribution (entire file).
Low risk = Vol < 33rd percentile
Medium risk = 33rd - 66th percentile
High risk = > 66th percentile</textarea>
                        </div>
                        <button id="labelBtn" class="btn primary">Start Labelling</button>
                    </div>
                </div>

                <div class="grid-container">
                    <div class="card log-section">
                        <h3>3. Server Status & Logs</h3>
                        <div id="volServerLogs" class="log-window">
                            <div class="log-entry system">Waiting for action...</div>
                        </div>
                    </div>

                    <div class="card parameters-section">
                        <h3>Parameters Used</h3>
                        <ul class="params-list" id="volParamsList">
                            <li>Waiting for computation...</li>
                        </ul>
                    </div>
                </div>

                <div class="card preview-section hidden" id="volPreviewCard">
                    <h3>4. Output Preview</h3>
                    <div class="output-info">
                        <strong>Saved to:</strong> <span id="volOutputPath" class="highlight-path">...</span>
                        <button class="btn small" onclick="copyPath('volOutputPath')">Copy Path</button>
                    </div>
                    <div class="table-wrapper">
                        <table id="volPreviewTable">
                            <thead></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- Clustering Tab -->
            <div id="clustering" class="tab-content hidden">
                <header class="tab-header">
                    <h1>Clustering</h1>
                    <p>Detect clusters and regime changes using advanced clustering algorithms.</p>
                </header>

                <div class="card">
                    <h3>1. Configuration</h3>
                    <div class="file-upload-container">
                        <div class="row">
                            <div class="input-group" style="flex: 1;">
                                <label>Algorithm</label>
                                <select id="clusterAlgorithm" class="input-text">
                                    <option value="dbscan">DBSCAN (Density-Based)</option>
                                    <option value="kmeans">K-Means</option>
                                </select>
                            </div>
                            <div class="input-group" style="flex: 2;">
                                <label>Input File (Labeled Data)</label>
                                <div class="row">
                                    <input type="text" id="clusterInputPath" class="input-text"
                                        placeholder="Path to LBL_VOL_... file">
                                    <label for="clusterCsvFile" class="btn small">Browse</label>
                                    <input type="file" id="clusterCsvFile" accept=".csv" hidden>
                                </div>
                            </div>
                        </div>
                        <div class="row" id="dbscanParams">
                            <div class="input-group">
                                <label>Min Samples (n)</label>
                                <input type="number" id="paramN" class="input-number" value="100" min="2">
                            </div>
                            <div class="input-group">
                                <label>K-Neighbors (k)</label>
                                <input type="number" id="paramK" class="input-number" value="3" min="2">
                            </div>
                        </div>
                        <div class="row hidden" id="kmeansParams">
                            <div class="input-group">
                                <label>Number of Clusters (K)</label>
                                <input type="number" id="kmeansK" class="input-number" value="auto" placeholder="auto"
                                    min="2" max="20">
                                <small style="color: var(--text-muted); font-size: 0.85em;">Leave as 'auto' for elbow
                                    method</small>
                            </div>
                            <div class="input-group">
                                <label>K Range (Min)</label>
                                <input type="number" id="kmeansKMin" class="input-number" value="2" min="2" max="10">
                            </div>
                            <div class="input-group">
                                <label>K Range (Max)</label>
                                <input type="number" id="kmeansKMax" class="input-number" value="10" min="3" max="20">
                            </div>
                        </div>

                        <button id="clusterBtn" class="btn primary">Run Clustering</button>
                    </div>
                </div>

                <div class="grid-container">
                    <div class="card log-section">
                        <h3>2. Clustering Logs</h3>
                        <div id="clusterServerLogs" class="log-window">
                            <div class="log-entry system">Ready to cluster.</div>
                        </div>
                    </div>

                    <div class="card parameters-section">
                        <h3>Results Summary</h3>
                        <ul class="params-list" id="clusterResultsList">
                            <li>Waiting for run...</li>
                        </ul>
                    </div>
                </div>

                <div class="card hidden" id="elbowChartCard" style="margin-top: 1rem;">
                    <h3>K-Distance Graph (Elbow Method)</h3>
                    <div style="position: relative; height: 400px;">
                        <canvas id="elbowChart"></canvas>
                    </div>
                </div>

                <div class="card preview-section hidden" id="clusterPreviewCard">
                    <h3>3. Output Preview</h3>
                    <div class="output-info">
                        <strong>Saved to:</strong> <span id="clusterOutputPath" class="highlight-path">...</span>
                        <button class="btn small" onclick="copyPath('clusterOutputPath')">Copy Path</button>
                    </div>
                    <div class="table-wrapper">
                        <table id="clusterPreviewTable">
                            <thead></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="app.js"></script>
</body>

</html>