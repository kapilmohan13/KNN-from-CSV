<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volatility Risk Analyzer (VRA)</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar / Navigation -->
        <nav class="sidebar">
            <div class="logo">
                <h2>VRA System</h2>
            </div>
            <ul class="nav-links">
                <li class="active" data-tab="indicators">Indicators Calculator</li>
                <li data-tab="volatility">2. Volatility & Labels</li>
                <li data-tab="clustering">3. DBSCAN Clustering</li>
                <li data-tab="mltraining">4. ML Training</li>
                <li data-tab="hybridml">5. Hybrid-ML</li>
                <li class="disabled">Backtesting (Coming Soon)</li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Indicators Tab -->
            <div id="indicators" class="tab-content active">
                <header class="tab-header">
                    <h1>Indicators Calculator</h1>
                    <p>Process historical data to generate technical indicators.</p>
                </header>

                <div class="card upload-section">
                    <h3>1. Datasets</h3>
                    <div class="file-upload-container">
                        <label for="csvFile" class="file-drop-zone">
                            <span class="icon">ðŸ“‚</span>
                            <span class="text">Click to select CSV file</span>
                            <span class="subtext" id="fileName">No file selected</span>
                        </label>
                        <input type="file" id="csvFile" accept=".csv" hidden>
                        <button id="calculateBtn" class="btn primary" disabled>Calculate Indicators</button>
                    </div>
                </div>

                <div class="grid-container">
                    <div class="card log-section">
                        <h3>2. Server Status & Logs</h3>
                        <div id="serverLogs" class="log-window">
                            <div class="log-entry system">Waiting for action...</div>
                        </div>
                    </div>

                    <div class="card parameters-section">
                        <h3>Parameters Used</h3>
                        <ul class="params-list">
                            <li><strong>RSI:</strong> 14 periods</li>
                            <li><strong>Stoch RSI:</strong> 14 periods</li>
                            <li><strong>MACD:</strong> 12, 26, 9</li>
                            <li><strong>Moving Average:</strong> 16 periods</li>
                            <li><strong>ROC:</strong> 10 periods</li>
                            <li><strong>Williams %R:</strong> 14 periods</li>
                            <li><strong>VWMA:</strong> 14 periods</li>
                            <li><strong>Linear Reg MA:</strong> 14 periods</li>
                        </ul>
                    </div>
                </div>

                <div class="card preview-section hidden" id="previewCard">
                    <h3>3. Output Preview</h3>
                    <div class="output-info">
                        <strong>Saved to:</strong> <span id="outputPath" class="highlight-path">...</span>
                        <button class="btn small" onclick="copyPath('outputPath')">Copy Path</button>
                    </div>
                    <div class="table-wrapper">
                        <table id="previewTable">
                            <thead></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Volatility Tab -->
            <div id="volatility" class="tab-content hidden">
                <header class="tab-header">
                    <h1>Volatility Calculator</h1>
                    <p>Compute historical volatility (Log Returns Std Dev) for risk analysis.</p>
                </header>

                <div class="card">
                    <h3>1. Input Data & Volatility Calculation</h3>
                    <div class="file-upload-container">
                        <div class="input-group">
                            <label>File Path (Previous Output Preselected)</label>
                            <div class="row">
                                <input type="text" id="volInputPath" class="input-text"
                                    placeholder="Path to processed CSV...">
                                <label for="volCsvFile" class="btn small">Browse</label>
                                <input type="file" id="volCsvFile" accept=".csv" hidden>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Window Size (Periods)</label>
                            <input type="number" id="volWindow" class="input-number" value="21" min="2">
                        </div>
                        <button id="computeVolBtn" class="btn primary">Compute Volatility</button>
                    </div>
                </div>

                <div class="card">
                    <h3>2. Label Addition</h3>
                    <div class="label-section">
                        <div class="input-group">
                            <label>Labelling Strategy</label>
                            <select id="labelStrategy" class="input-select">
                                <option value="relative_thresholds">Relative Thresholds (Percentile Based)</option>
                                <option value="future_strategy" disabled>Future Strategy (Coming Soon)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Strategy Description</label>
                            <textarea id="labelDesc" class="desc-box" readonly>Compare each rowâ€™s volatility to the historical distribution (entire file).
Low risk = Vol < 33rd percentile
Medium risk = 33rd - 66th percentile
High risk = > 66th percentile</textarea>
                        </div>
                        <button id="labelBtn" class="btn primary">Start Labelling</button>
                    </div>
                </div>

                <div class="grid-container">
                    <div class="card log-section">
                        <h3>3. Server Status & Logs</h3>
                        <div id="volServerLogs" class="log-window">
                            <div class="log-entry system">Waiting for action...</div>
                        </div>
                    </div>

                    <div class="card parameters-section">
                        <h3>Parameters Used</h3>
                        <ul class="params-list" id="volParamsList">
                            <li>Waiting for computation...</li>
                        </ul>
                    </div>
                </div>

                <div class="card preview-section hidden" id="volPreviewCard">
                    <h3>4. Output Preview</h3>
                    <div class="output-info">
                        <strong>Saved to:</strong> <span id="volOutputPath" class="highlight-path">...</span>
                        <button class="btn small" onclick="copyPath('volOutputPath')">Copy Path</button>
                    </div>
                    <div class="table-wrapper">
                        <table id="volPreviewTable">
                            <thead></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- Clustering Tab -->
            <div id="clustering" class="tab-content hidden">
                <header class="tab-header">
                    <h1>Clustering</h1>
                    <p>Detect clusters and regime changes using advanced clustering algorithms.</p>
                </header>

                <div class="card">
                    <h3>1. Configuration</h3>
                    <div class="file-upload-container">
                        <div class="row">
                            <div class="input-group" style="flex: 1;">
                                <label>Algorithm</label>
                                <select id="clusterAlgorithm" class="input-text">
                                    <option value="dbscan">DBSCAN (Density-Based)</option>
                                    <option value="kmeans">K-Means</option>
                                </select>
                            </div>
                            <div class="input-group" style="flex: 2;">
                                <label>Input File (Labeled Data)</label>
                                <div class="row">
                                    <input type="text" id="clusterInputPath" class="input-text"
                                        placeholder="Path to LBL_VOL_... file">
                                    <label for="clusterCsvFile" class="btn small">Browse</label>
                                    <input type="file" id="clusterCsvFile" accept=".csv" hidden>
                                </div>
                            </div>
                        </div>
                        <div class="row" id="dbscanParams">
                            <div class="input-group">
                                <label>Min Samples (n)</label>
                                <input type="number" id="paramN" class="input-number" value="100" min="2">
                            </div>
                            <div class="input-group">
                                <label>K-Neighbors (k)</label>
                                <input type="number" id="paramK" class="input-number" value="3" min="2">
                            </div>
                        </div>
                        <div class="row hidden" id="kmeansParams">
                            <div class="input-group">
                                <label>Number of Clusters (K)</label>
                                <input type="number" id="kmeansK" class="input-number" value="auto" placeholder="auto"
                                    min="2" max="20">
                                <small style="color: var(--text-muted); font-size: 0.85em;">Leave as 'auto' for elbow
                                    method</small>
                            </div>
                            <div class="input-group">
                                <label>K Range (Min)</label>
                                <input type="number" id="kmeansKMin" class="input-number" value="2" min="2" max="10">
                            </div>
                            <div class="input-group">
                                <label>K Range (Max)</label>
                                <input type="number" id="kmeansKMax" class="input-number" value="10" min="3" max="20">
                            </div>
                        </div>

                        <button id="clusterBtn" class="btn primary">Run Clustering</button>
                    </div>
                </div>

                <div class="grid-container">
                    <div class="card log-section">
                        <h3>2. Clustering Logs</h3>
                        <div id="clusterServerLogs" class="log-window">
                            <div class="log-entry system">Ready to cluster.</div>
                        </div>
                    </div>

                    <div class="card parameters-section">
                        <h3>Results Summary</h3>
                        <ul class="params-list" id="clusterResultsList">
                            <li>Waiting for run...</li>
                        </ul>
                    </div>
                </div>

                <div class="card hidden" id="elbowChartCard" style="margin-top: 1rem;">
                    <h3>K-Distance Graph (Elbow Method)</h3>
                    <div style="position: relative; height: 400px;">
                        <canvas id="elbowChart"></canvas>
                    </div>
                </div>

                <div class="card preview-section hidden" id="clusterPreviewCard">
                    <h3>3. Output Preview</h3>
                    <div class="output-info">
                        <strong>Saved to:</strong> <span id="clusterOutputPath" class="highlight-path">...</span>
                        <button class="btn small" onclick="copyPath('clusterOutputPath')">Copy Path</button>
                    </div>
                    <div class="table-wrapper">
                        <table id="clusterPreviewTable">
                            <thead></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ML Training Tab -->
            <div id="mltraining" class="tab-content hidden">
                <header class="tab-header">
                    <h1>ML Training & Stats</h1>
                    <p>Train models to predict future volatility and evaluate classification performance.</p>
                </header>

                <div class="card">
                    <h3>1. Configuration</h3>
                    <div class="file-upload-container" style="flex-wrap: wrap;">
                        <div class="row" style="width: 100%;">
                            <div class="input-group" style="flex: 1;">
                                <label>Algorithm</label>
                                <select id="mlAlgorithm" class="input-select">
                                    <option value="linear_regression">Linear Regression</option>
                                    <option value="xgboost">XGBoost (Regressor)</option>
                                    <option value="lstm">LSTM (Deep Learning)</option>
                                    <option value="random_forest">Random Forest (Regressor)</option>
                                </select>
                            </div>
                            <div class="input-group" style="flex: 1;">
                                <label>Validation Strategy</label>
                                <select id="mlValidation" class="input-select">
                                    <option value="rolling">Rolling Window Validation</option>
                                    <option value="walk_forward">Walk-Forward (Expanding) Validation</option>
                                </select>
                            </div>
                            <div class="input-group" style="flex: 1;">
                                <label>Segmentation Mode</label>
                                <select id="mlSegmentMode" class="input-select">
                                    <option value="count">Record Count (Fixed Size)</option>
                                    <option value="month">Monthly (Calendar Month)</option>
                                </select>
                            </div>
                        </div>
                        <div class="row" style="width: 100%; margin-top: 12px;">
                            <div class="input-group" style="flex: 2;">
                                <label>Input File (Labeled Volatility Data)</label>
                                <div class="row">
                                    <input type="text" id="mlInputPath" class="input-text"
                                        placeholder="Path to LBL_VOL_... file">
                                    <label for="mlCsvFile" class="btn small">Browse</label>
                                    <input type="file" id="mlCsvFile" accept=".csv" hidden>
                                </div>
                            </div>
                            <div class="input-group" id="mlWindowGroup">
                                <label id="mlWindowLabel">Window Size (segments)</label>
                                <input type="number" id="mlWindowSize" class="input-number" value="6" min="2" max="20">
                                <small style="color: var(--text-muted); font-size: 0.8em;" id="mlWindowHint">Train on N
                                    segments, test on next</small>
                            </div>
                        </div>
                        <div style="width: 100%; margin-top: 12px;">
                            <button id="mlTrainBtn" class="btn primary">Start Training</button>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 0;">
                    <h3>Validation Strategy Description</h3>
                    <textarea id="mlValidationDesc" class="desc-box" readonly>Rolling Window: Train on a fixed-size window (e.g., segments 1â€“6), test on segment 7.
Then roll forward: train on segments 2â€“7, test on segment 8, and so on.
Collects performance metrics across all test windows.</textarea>
                </div>

                <div class="grid-container">
                    <div class="card log-section">
                        <h3>2. Training Logs</h3>
                        <div id="mlServerLogs" class="log-window">
                            <div class="log-entry system">Ready for ML training.</div>
                        </div>
                    </div>

                    <div class="card parameters-section">
                        <h3>Regression Metrics</h3>
                        <ul class="params-list" id="mlMetricsList">
                            <li>Waiting for training...</li>
                        </ul>
                    </div>
                </div>

                <div class="card hidden" id="mlClassificationCard">
                    <h3>3. Classification Metrics</h3>
                    <div class="row" style="gap: 24px; align-items: flex-start;">
                        <div style="flex: 1;">
                            <ul class="params-list" id="mlClassMetricsList"></ul>
                        </div>
                        <div style="flex: 0 0 auto;">
                            <button id="mlConfusionBtn" class="btn primary" style="background: var(--primary);">Show
                                Confusion Matrix</button>
                        </div>
                    </div>
                </div>

                <div class="card hidden" id="mlFoldsCard">
                    <h3>4. Fold Results</h3>
                    <div class="table-wrapper">
                        <table id="mlFoldsTable">
                            <thead></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div class="card hidden" id="mlFilesCard">
                    <h3>5. Saved Files</h3>
                    <ul class="params-list" id="mlFilesList"></ul>
                </div>
            </div>

            <!-- Confusion Matrix Modal -->
            <div id="cmModal" class="modal-overlay hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Confusion Matrix</h2>
                        <button id="cmModalClose" class="btn small"
                            style="font-size: 1.2rem; padding: 4px 12px;">&times;</button>
                    </div>
                    <div id="cmBody" class="cm-body">
                        <!-- Will be populated by JS -->
                    </div>
                    <div id="cmLegend" class="cm-legend"></div>
                </div>
            </div>

            <!-- Hybrid-ML Tab -->
            <div id="hybridml" class="tab-content hidden">
                <header class="tab-header">
                    <h1>Hybrid-ML Training</h1>
                    <p>Train the same models using cluster-augmented data (one-hot encoded) to see if clustering
                        improves prediction performance.</p>
                </header>

                <div class="card">
                    <h3>1. Configuration</h3>
                    <div class="file-upload-container" style="flex-wrap: wrap;">
                        <div class="row" style="width: 100%;">
                            <div class="input-group" style="flex: 1;">
                                <label>Cluster Source</label>
                                <select id="hybridClusterSource" class="input-select">
                                    <option value="dbscan">DBSCAN</option>
                                    <option value="kmeans">K-Means</option>
                                </select>
                            </div>
                            <div class="input-group" style="flex: 2;">
                                <label>Cluster File</label>
                                <div class="row">
                                    <input type="text" id="hybridFilePath" class="input-text"
                                        placeholder="Auto-populated from clustering output" readonly
                                        style="opacity: 0.8; cursor: default;">
                                    <label for="hybridCsvFile" class="btn small">Browse</label>
                                    <input type="file" id="hybridCsvFile" accept=".csv" hidden>
                                </div>
                                <small id="hybridFileHint" style="color: var(--text-muted); font-size: 0.8em;">Select a
                                    cluster source or browse a CLUSTER_* file</small>
                            </div>
                        </div>
                        <div class="row" style="width: 100%; margin-top: 12px;">
                            <div class="input-group" style="flex: 1;">
                                <label>Algorithm</label>
                                <select id="hybridAlgorithm" class="input-select">
                                    <option value="linear_regression">Linear Regression</option>
                                    <option value="xgboost">XGBoost (Regressor)</option>
                                    <option value="lstm">LSTM (Deep Learning)</option>
                                    <option value="random_forest">Random Forest (Regressor)</option>
                                </select>
                            </div>
                            <div class="input-group" style="flex: 1;">
                                <label>Validation Strategy</label>
                                <select id="hybridValidation" class="input-select">
                                    <option value="rolling">Rolling Window Validation</option>
                                    <option value="walk_forward">Walk-Forward (Expanding) Validation</option>
                                </select>
                            </div>
                            <div class="input-group" style="flex: 1;">
                                <label>Segmentation Mode</label>
                                <select id="hybridSegmentMode" class="input-select">
                                    <option value="count">Record Count (Fixed Size)</option>
                                    <option value="month">Monthly (Calendar Month)</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label id="hybridWindowLabel">Window Size (segments)</label>
                                <input type="number" id="hybridWindowSize" class="input-number" value="6" min="2"
                                    max="20">
                                <small style="color: var(--text-muted); font-size: 0.8em;" id="hybridWindowHint">Train
                                    on N segments, test on next</small>
                            </div>
                        </div>
                        <div style="width: 100%; margin-top: 12px;">
                            <button id="hybridTrainBtn" class="btn primary">Start Hybrid Training</button>
                        </div>
                    </div>
                </div>

                <div class="grid-container">
                    <div class="card log-section">
                        <h3>2. Training Logs</h3>
                        <div id="hybridServerLogs" class="log-window">
                            <div class="log-entry system">Ready for Hybrid-ML training.</div>
                        </div>
                    </div>

                    <div class="card parameters-section">
                        <h3>Regression Metrics</h3>
                        <ul class="params-list" id="hybridMetricsList">
                            <li>Waiting for training...</li>
                        </ul>
                    </div>
                </div>

                <div class="card hidden" id="hybridClassificationCard">
                    <h3>3. Classification Metrics</h3>
                    <div class="row" style="gap: 24px; align-items: flex-start;">
                        <div style="flex: 1;">
                            <ul class="params-list" id="hybridClassMetricsList"></ul>
                        </div>
                        <div style="flex: 0 0 auto;">
                            <button id="hybridConfusionBtn" class="btn primary" style="background: var(--primary);">Show
                                Confusion Matrix</button>
                        </div>
                    </div>
                </div>

                <div class="card hidden" id="hybridFoldsCard">
                    <h3>4. Fold Results</h3>
                    <div class="table-wrapper">
                        <table id="hybridFoldsTable">
                            <thead></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div class="card hidden" id="hybridFilesCard">
                    <h3>5. Saved Files</h3>
                    <ul class="params-list" id="hybridFilesList"></ul>
                </div>
            </div>

        </main>
    </div>
    <script src="app.js"></script>
</body>

</html>